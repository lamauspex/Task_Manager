
# Architecture Overview

## Данный раздел посвящен архитектурному дизайну нашего проекта, основанного на фреймворке FastAPI. Мы рассмотрим основные компоненты, их взаимосвязи и общий поток данных.

### Проект организован следующим образом:

- /src: Главная директория исходников.
- /src/app: Ядро приложения.
- /src/core: Ключевые вспомогательные модули, такие как безопасность, логирование, база данных.
- /src/integrations: Внешние интеграции (Google Календарь).
- /src/models: SQLAlchemy-модели для базы данных.
- /src/repositories: Логика взаимодействия с базой данных.
- /src/routers: Роутеры API.
- /src/schemas: Pydantic-схемы для валидирования входящих и исходящих данных.
- /src/services: Бизнес-логика.
- /tests: Тесты (интеграционные и юнит-тесты).


### Работа с API

Проект предоставляет RESTful API для работы с задачами и пользователями. Все endpoints описаны ниже:

#### Пользователи (Users)
Метод	Endpoint	Описание
GET	/users/{user_id}	Информация о конкретном пользователе
GET	/users/list	Список всех пользователей
POST	/users	Создание нового пользователя
PUT	/users/{user_id}	Обновление пользователя
DELETE	/users/{user_id}	Удаление пользователя

#### Задачи (Tasks)
Метод	Endpoint	Описание
GET	/tasks/{task_id}	Информация о конкретной задаче
GET	/tasks/list	Список всех задач
POST	/tasks	Создание новой задачи
PUT	/tasks/{task_id}	Обновление задачи
PUT	/tasks/{task_id}/assign	Назначение задачи другому пользователю
PUT	/tasks/{task_id}/complete	Отметить задачу как выполненную
DELETE	/tasks/{task_id}	Удаление задачи

#### Календарь (Calendar)
Метод	Endpoint	Описание
GET	/calendar/events	Получение предстоящих событий календаря
POST	/calendar/create-event	Создание события в календаре



### Безопасность и аутентификация
JWT токены используются для авторизации. Доступ ко многим маршрутам требует наличия действительного токена.



### Модель данных
Все таблицы сохраняются в PostgreSQL с поддержкой асинхронных операций через SQLAlchemy.

#### Модель пользователя (User)
Поля:
id: Уникальный идентификатор пользователя.
first_name, last_name: Имя и фамилия пользователя.
email: Электронная почта пользователя (уникальна).
password_hash: Хэшиованный пароль.
role: Роль пользователя (USER, ADMIN).
active: Активирован ли аккаунт.

#### Модель задачи (Task)
Поля:
id: Уникальный идентификатор задачи.
title: Название задачи.
description: Описание задачи.
status: Статус задачи (CREATED, ASSIGNED, COMPLETED).
assigned_to_id: Идентификатор назначенного пользователя.
completed_by_id: Идентификатор исполнителя задачи.
Сервисы и логика
Основные сервисы:

- UsersService: Предоставляет операции с пользователями (регистрация, обновление, удаление).

- TasksService: Управление задачами (создание, изменение статуса, завершение, удаление).

- GoogleCalendarIntegration: Осуществляет интеграцию с Google Calendar для добавления и чтения событий.


### Components

Проект состоит из следующих ключевых компонентов:

- Models: Классические SQLAlchemy-модели, представляющие сущности нашей базы данных (например, пользователи и задачи).

- Repositories: Абстрагированные уровни доступа к данным, обеспечивающие изоляцию между моделью данных и уровнем представления.

- Services: Уровень бизнес-логики, содержащий основную обработку данных и выполнение операций (таких как создание задач, проверка полномочий и т.п.).

- Routers: Конкретные маршруты и обработчики запросов, определяющие конечные точки API.

- Integrations: Компоненты, интегрирующие внешние сервисы (например, Google Calendar).

- Middleware: Промежуточные обработчики запросов, осуществляющие проверку подлинности, ведение журнала и другие задачи общего характера.
Data Flow

- Request Arrival: Клиент отправляет запрос на определенный маршрут (endpoint).

- Authentication & Authorization: Запрос проходит через слой авторизации, проверяя наличие токена и полномочия пользователя.

- Business Logic Execution: Сервер получает запрос и вызывает соответствующий сервис для выполнения нужной операции (например, получение данных, создание задачи и т.д.).

- Database Interaction: Через репозитории осуществляется доступ к базе данных, чтение или запись данных.

- Response Generation: Ответ формируется обратно в клиент, проходя обратный путь через все предыдущие этапы.



### Layered Architecture Diagram
Применяется классический слоёный подход к архитектуре:

- Presentation Layer: Представляет собой уровень взаимодействий с клиентом (API Routes).

- Application Services: Уровень сервисов, содержащих бизнес-логику (Services).

- Domain Models: Логика предметной области представлена нашими SQLAlchemy-моделями.

- Infrastructure: Внедрение инфраструктуры, включая репозитории и интегрированные сервисы.



### Conclusion
Такая архитектура позволяет легко расширять и поддерживать проект, сохраняя ясность и четкость разделения ответственности между разными компонентами.

